<!-- Customer Reviews Section -->
<section class="reviews-section">
  <h2>Customer Reviews 
    <% if (reviewCount > 0) { %>
      (<%= reviewCount %> 
      <%= reviewCount === 1 ? 'review' : 'reviews' %>)
    <% } %>
  </h2>
  
  <% if (avgRating > 0) { %>
    <div class="average-rating">
      <div class="stars">
        <% for(let i = 1; i <= 5; i++) { %>
          <% if (i <= Math.round(avgRating)) { %>
            <span class="star filled">★</span>
          <% } else { %>
            <span class="star">☆</span>
          <% } %>
        <% } %>
      </div>
      <p class="rating-text"><%= parseFloat(avgRating).toFixed(1) %> out of 5 stars</p>
    </div>
  <% } %>

  <!-- Review Form (only if logged in) -->
  <% if (locals.loggedin) { %>
    <div class="review-form">
      <h3>Write a Review</h3>
      <%- messages() %>
      <form action="/review/submit" method="post">
        <input type="hidden" name="inv_id" value="<%= inv_id %>">
        
        <div class="form-group">
          <label for="review_rating">Rating:</label>
          <select name="review_rating" id="review_rating" required>
            <option value="">Select rating</option>
            <option value="5">⭐⭐⭐⭐⭐ (5 stars)</option>
            <option value="4">⭐⭐⭐⭐ (4 stars)</option>
            <option value="3">⭐⭐⭐ (3 stars)</option>
            <option value="2">⭐⭐ (2 stars)</option>
            <option value="1">⭐ (1 star)</option>
          </select>
        </div>

        <div class="form-group">
          <label for="review_text">Your Review:</label>
          <textarea 
            name="review_text" 
            id="review_text" 
            rows="5" 
            placeholder="Share your thoughts about this vehicle..."
            required
            minlength="10"
          ></textarea>
        </div>

        <button type="submit" class="btn-primary">Submit Review</button>
      </form>
    </div>
  <% } else { %>
    <p class="login-prompt">
      <a href="/account/login">Please login</a> to write a review.
    </p>
  <% } %>

  <!-- Display existing reviews -->
  <div class="reviews-list">
    <% if (reviews && reviews.length > 0) { %>
      <% reviews.forEach(review => { %>
        <div class="review-item">
          <div class="review-header">
            <div class="reviewer-info">
              <strong><%= review.account_firstname %> <%= review.account_lastname.charAt(0) %>.</strong>
              <div class="review-stars">
                <% for(let i = 1; i <= 5; i++) { %>
                  <% if (i <= review.review_rating) { %>
                    <span class="star filled">★</span>
                  <% } else { %>
                    <span class="star">☆</span>
                  <% } %>
                <% } %>
              </div>
            </div>
            <span class="review-date">
              <%= new Date(review.review_date).toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              }) %>
            </span>
          </div>
          <p class="review-text"><%= review.review_text %></p>
        </div>
      <% }) %>
    <% } else { %>
      <p class="no-reviews">No reviews yet. Be the first to review this vehicle!</p>
    <% } %>
  </div>
</section>
